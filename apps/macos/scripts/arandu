#!/bin/bash
# Arandu CLI â€” opens Markdown files with the Arandu app
# Usage: arandu [--wait] [file.md ...]

WAIT=""
FILES=()
for arg in "$@"; do
    case "$arg" in
        --wait|-W) WAIT="-W" ;;
        *) FILES+=("$arg") ;;
    esac
done

# Prefer /Applications, fall back to ~/Applications
if [ -d "/Applications/Arandu.app" ]; then
    APP="/Applications/Arandu.app"
elif [ -d "$HOME/Applications/Arandu.app" ]; then
    APP="$HOME/Applications/Arandu.app"
else
    echo "Arandu.app not found. Run 'make install' first." >&2
    exit 1
fi

if [ "${#FILES[@]}" -eq 0 ]; then
    open $WAIT "$APP"
else
    # Pass all files as --args to bypass the UTI document system
    PATHS=()
    for f in "${FILES[@]}"; do
        abs=$(cd "$(dirname "$f")" 2>/dev/null && echo "$PWD/$(basename "$f")")
        PATHS+=("$abs")
    done
    open -n $WAIT "$APP" --args "${PATHS[@]}"
fi
exit 0
